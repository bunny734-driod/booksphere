<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Reading Nook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #64748b;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #475569;
        }
        .genre-btn.active {
            background-color: #2563eb;
            color: white;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-white shadow-2xl rounded-2xl w-full max-w-5xl p-8 md:p-12 space-y-8">
        <header class="text-center pb-6 border-b border-gray-200">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-800 tracking-tight">
                The Reading Nook ðŸ“–
            </h1>
            <p class="mt-2 text-xl text-gray-500">
                A curated collection of stories and poetry.
            </p>
        </header>

        <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <div class="relative w-full md:w-1/2">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                    <i class="fas fa-search text-gray-400"></i>
                </div>
                <input type="text" id="search-input" placeholder="Search titles..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
            </div>
            
            <div class="flex space-x-2 sm:space-x-4">
                <button id="stories-btn" class="px-5 py-2 font-semibold text-sm sm:text-lg rounded-full transition-all duration-300 transform hover:scale-105 active:scale-95 bg-blue-600 text-white shadow-lg shadow-blue-300">
                    Stories
                </button>
                <button id="poetry-btn" class="px-5 py-2 font-semibold text-sm sm:text-lg rounded-full transition-all duration-300 transform hover:scale-105 active:scale-95 bg-gray-200 text-gray-800 hover:bg-gray-300">
                    Poetry
                </button>
                <button id="favorites-btn" class="px-5 py-2 font-semibold text-sm sm:text-lg rounded-full transition-all duration-300 transform hover:scale-105 active:scale-95 bg-gray-200 text-gray-800 hover:bg-gray-300">
                    <i class="fas fa-heart text-red-500"></i> Favorites
                </button>
            </div>
        </div>
        
        <div id="genre-filters" class="flex flex-wrap gap-2 justify-center">
        </div>

        <main>
            <section id="content-collection" class="grid grid-cols-1 md:grid-cols-2 gap-8 transition-opacity duration-500">
            </section>
        </main>

        <section class="mt-12 pt-8 border-t border-gray-200">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">New Arrivals ðŸŽ‰</h2>
            <div id="new-arrivals-collection" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                </div>
        </section>

        <section class="mt-12 pt-8 border-t border-gray-200 text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Suggest a Book or Poem</h2>
            <p class="text-gray-600 mb-6">Help us grow our collection! We'd love to hear your suggestions.</p>
            <form id="suggestion-form" class="space-y-4">
                <input type="text" id="suggestion-title" placeholder="Title" required class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <textarea id="suggestion-description" placeholder="Description or brief text" required rows="3" class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                <select id="suggestion-type" class="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="story">Story</option>
                    <option value="poetry">Poetry</option>
                </select>
                <button type="submit" class="w-full max-w-md px-6 py-2 font-semibold text-white bg-blue-600 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-300">
                    Submit Suggestion
                </button>
            </form>
            <p id="suggestion-message" class="mt-4 text-green-600 font-semibold hidden">Thank you for your suggestion!</p>
        </section>

    </div>

    <div id="content-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal">
        <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full p-8 relative max-h-full overflow-y-auto">
            <button id="modal-close-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <h2 id="modal-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
            <div id="modal-content" class="text-gray-700 text-lg leading-relaxed whitespace-pre-line"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const storiesBtn = document.getElementById('stories-btn');
            const poetryBtn = document.getElementById('poetry-btn');
            const favoritesBtn = document.getElementById('favorites-btn');
            const contentCollection = document.getElementById('content-collection');
            const newArrivalsCollection = document.getElementById('new-arrivals-collection');
            const searchInput = document.getElementById('search-input');
            const genreFiltersContainer = document.getElementById('genre-filters');
            const contentModal = document.getElementById('content-modal');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');
            const suggestionForm = document.getElementById('suggestion-form');
            const suggestionTitleInput = document.getElementById('suggestion-title');
            const suggestionDescriptionInput = document.getElementById('suggestion-description');
            const suggestionTypeSelect = document.getElementById('suggestion-type');
            const suggestionMessage = document.getElementById('suggestion-message');

            // --- Data for our library ---
            const libraryContent = {
                stories: [
                    {
                        id: 's1',
                        title: 'The Emerald Compass',
                        description: "A thrilling adventure about a young cartographer who discovers a magical compass that points not north, but to the heart's true desire.",
                        fullText: "A thrilling adventure about a young cartographer who discovers a magical compass that points not north, but to the heart's true desire. Elara, with her worn maps and calloused hands, always dreamed of something more than charting the mundane world. One day, she stumbled upon an ancient tome, and within its pages, a riddle led her to the Emerald Compass. The compass, humming with a soft, green light, didn't follow magnetic north. Instead, it quivered and spun, pointing towards a new adventure waiting in the west. With a mix of fear and excitement, she packed her bags, ready to follow the compass to a destiny she never knew she had.",
                        genre: ['Fantasy', 'Adventure']
                    },
                    {
                        id: 's2',
                        title: 'The Last Starfall',
                        description: "A poignant sci-fi tale of a lone astronaut witnessing the final light of a dying star system, reflecting on life, memory, and the vastness of space.",
                        fullText: "A poignant sci-fi tale of a lone astronaut witnessing the final light of a dying star system, reflecting on life, memory, and the vastness of space. Commander Vex stood on the observation deck, the nebula before him pulsating with colors he'd only seen in ancient art. This was the end of a cosmic cycle, a beautiful, violent death. He thought of Earth, a world he'd left behind, and the faces of loved ones now just fleeting memories. In this final moment, with the universe's light show as his only companion, he felt a profound sense of peace. The starfall was not an ending, but a reminder of the fleeting, precious nature of existence.",
                        genre: ['Sci-Fi', 'Poignant']
                    },
                    {
                        id: 's3',
                        title: 'Beneath the Willow',
                        description: "A quiet, slice-of-life story about two friends who meet under a willow tree every summer, sharing their dreams and fears over the years.",
                        fullText: "A quiet, slice-of-life story about two friends who meet under a willow tree every summer, sharing their dreams and fears over the years. Maya and Leo first met beneath the great willow in the town square when they were just children. Each year, as the leaves turned green, they'd return to their spot, carving another notch into the tree's trunk. They spoke of school, of first loves, of their hopes to travel the world. The willow watched them grow, its branches a silent witness to their laughter and their tears. It was a constant in their ever-changing lives, a testament to the enduring power of friendship.",
                        genre: ['Slice of Life', 'Drama']
                    },
                    {
                        id: 's4',
                        title: 'The Whispering Library',
                        description: "A mysterious library where books speak their stories aloud to those who listen closely. A young scholar embarks on a quest to find its heart.",
                        fullText: "A mysterious library where books speak their stories aloud to those who listen closely. A young scholar embarks on a quest to find its heart. Elian had heard the legends of the Whispering Library his whole life, but never believed them until he felt its pull. Upon entering, he was surrounded by a symphony of hushed voices, each a story waiting to be heard. He learned that to truly understand the library, he needed to find its heart, a single book that contained the wisdom of all others. He spent years listening to the books, following their subtle clues, hoping to one day find the source of their magic and uncover its secrets.",
                        genre: ['Fantasy', 'Mystery']
                    },
                    {
                        id: 's5',
                        title: 'The Stone-Hearted King',
                        description: "A classic fairytale retold, about a king whose heart turns to stone. Only a selfless act of love can save his kingdom and restore his humanity.",
                        fullText: "A classic fairytale retold, about a king whose heart turns to stone. Only a selfless act of love can save his kingdom and restore his humanity. King Theron, once a kind ruler, grew cold and distant after a great tragedy. His heart, once full of compassion, turned to solid stone, and with it, his kingdom began to wither. A prophecy foretold that only a selfless act of love, one that asked for nothing in return, could break the curse. Many tried to win his affection with riches and power, but none succeeded. It wasn't until a simple village girl, with no hope of reward, offered him a single, hand-carved wooden bird that a tear, a single drop of water, fell from his eye. The stone heart began to crack, and hope returned to his land.",
                        genre: ['Fairytale', 'Classic']
                    },
                ],
                poetry: [
                    {
                        id: 'p1',
                        title: 'Echoes of the Sea',
                        description: "The waves crash on the shore, a whispered plea,\nAn ancient rhythm for all to see.\nThe salt-kissed air, a story told,\nOf sailor's courage, brave and bold.",
                        fullText: "The waves crash on the shore, a whispered plea,\nAn ancient rhythm for all to see.\nThe salt-kissed air, a story told,\nOf sailor's courage, brave and bold.\n\nFrom ocean's depths, a deep refrain,\nA timeless song through sun and rain.\nThe gulls cry out in a lonely flight,\nA beacon home in the fading light.",
                        genre: ['Nature', 'Classic']
                    },
                    {
                        id: 'p2',
                        title: 'City at Dusk',
                        description: "The sun dips low, a final fiery gleam,\nReflecting glass in a concrete stream.\nStreetlights ignite, a golden, glowing haze,\nThe hurried city caught in evening's maze.",
                        fullText: "The sun dips low, a final fiery gleam,\nReflecting glass in a concrete stream.\nStreetlights ignite, a golden, glowing haze,\nThe hurried city caught in evening's maze.\n\nShadows stretch and twist and crawl,\nAs day's last light begins to fall.\nThe neon buzz, a siren's call,\nA vibrant city, standing tall.",
                        genre: ['Urban', 'Contemplative']
                    },
                    {
                        id: 'p3',
                        title: 'A Solitary Tree',
                        description: "In fields of green, where winds convene,\nA solitary tree, a lonely scene.\nIts branches reach for sun and rain,\nA quiet witness to joy and pain.",
                        fullText: "In fields of green, where winds convene,\nA solitary tree, a lonely scene.\nIts branches reach for sun and rain,\nA quiet witness to joy and pain.\n\nThrough winter's frost and summer's grace,\nIt stands alone in time and space.\nA symbol strong, of patient might,\nAgainst the fading of the light.",
                        genre: ['Nature', 'Lyrical']
                    },
                    {
                        id: 'p4',
                        title: 'The Baker\'s Song',
                        description: "The flour-dusted hands, a rhythmic sound,\nAs sweet bread rises from the ground.\nA fragrant warmth, a gentle hum,\nThe morning chorus of what's to come.",
                        fullText: "The flour-dusted hands, a rhythmic sound,\nAs sweet bread rises from the ground.\nA fragrant warmth, a gentle hum,\nThe morning chorus of what's to come.\n\nThe oven's glow, a golden hearth,\nNew life created on this earth.\nA simple joy, a daily art,\nTo feed the body and the heart.",
                        genre: ['Everyday Life', 'Sensory']
                    },
                ]
            };

            const newArrivals = [
                {
                    id: 's6',
                    title: 'The Clockwork Sparrow',
                    description: "A whimsical fantasy story about a young tinkerer who befriends a magical, mechanical bird and embarks on a quest to find the lost city of gears.",
                    fullText: "In the bustling city of Veridia, where steam and cogs filled the air, lived a young tinkerer named Leo. He spent his days in a workshop, surrounded by half-finished contraptions. One day, while rummaging through an old, forgotten box, he found a delicate, clockwork sparrow. The bird, with its intricate gears and polished brass feathers, blinked to life when Leo held it. It chirped a tune that seemed to be a map, leading him on a grand adventure to find the mythical city of gears. Along the way, he discovered not only the secrets of the sparrow but also the true meaning of friendship and ingenuity.",
                    genre: ['Fantasy', 'Whimsical']
                }
            ];

            // --- State Management ---
            let state = {
                currentView: localStorage.getItem('currentView') || 'stories',
                activeFilters: {
                    stories: [],
                    poetry: [],
                    favorites: []
                }
            };
            
            // --- Helper Functions ---
            const getFavorites = () => JSON.parse(localStorage.getItem('favorites')) || [];
            const saveFavorites = (favorites) => localStorage.setItem('favorites', JSON.stringify(favorites));

            const getUniqueGenres = (content) => {
                if (!content) return [];
                const allGenres = content.flatMap(item => item.genre);
                return ['All Genres', ...new Set(allGenres)].sort();
            };

            const findContentById = (id) => {
                const allContent = [...libraryContent.stories, ...libraryContent.poetry, ...newArrivals];
                return allContent.find(item => item.id === id);
            };

            const renderGenreFilters = () => {
                genreFiltersContainer.innerHTML = '';
                const genres = getUniqueGenres(libraryContent[state.currentView]);
                if (state.currentView === 'favorites' || genres.length <= 1) {
                    return;
                }
                
                genres.forEach(genre => {
                    const isActive = state.activeFilters[state.currentView].includes(genre) || (genre === 'All Genres' && state.activeFilters[state.currentView].length === 0);
                    const buttonClass = `genre-btn px-4 py-2 text-sm rounded-full font-medium transition-colors duration-200 ${isActive ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`;
                    genreFiltersContainer.innerHTML += `<button class="${buttonClass}" data-genre="${genre}">${genre}</button>`;
                });
            };

            // --- UI Rendering ---
            const renderContent = (content, targetElement) => {
                targetElement.innerHTML = '';
                if (content.length === 0) {
                    targetElement.innerHTML = '<p class="col-span-full text-center text-xl text-gray-500">No items found matching your criteria. ðŸ˜”</p>';
                    return;
                }
                const favorites = getFavorites();
                const viewType = state.currentView.slice(0, -1).toLowerCase();

                content.forEach(item => {
                    const isFavorite = favorites.includes(item.id);
                    const heartIconClass = isFavorite ? 'fas text-red-500' : 'far text-gray-400';
                    const ariaLabel = isFavorite ? `Remove "${item.title}" from favorites` : `Add "${item.title}" to favorites`;

                    const cardHtml = `
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-md hover:shadow-xl transition-shadow duration-300 flex flex-col justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">${item.title}</h2>
                                <p class="text-gray-600 mb-4 text-sm leading-relaxed whitespace-pre-line">${item.description}</p>
                            </div>
                            <div class="flex items-center justify-between mt-4">
                                <div class="space-x-2">
                                    ${item.genre.map(genre => `<span class="text-xs font-semibold px-2 py-1 rounded-full bg-gray-200 text-gray-600">${genre}</span>`).join('')}
                                </div>
                                <div class="flex items-center space-x-4">
                                    <button class="favorite-btn text-gray-400 hover:text-red-500 transition-colors duration-200" data-id="${item.id}" aria-label="${ariaLabel}">
                                        <i class="${heartIconClass} fa-heart"></i>
                                    </button>
                                    <button class="read-btn text-blue-600 hover:text-blue-800 font-medium" data-id="${item.id}">
                                        Read ${viewType} &rarr;
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    targetElement.innerHTML += cardHtml;
                });
            };

            const filterAndRender = () => {
                let filteredContent = [];
                const searchTerm = searchInput.value.toLowerCase();

                if (state.currentView === 'favorites') {
                    const favorites = getFavorites();
                    const allContent = [...libraryContent.stories, ...libraryContent.poetry, ...newArrivals];
                    filteredContent = allContent.filter(item => favorites.includes(item.id));
                } else {
                    filteredContent = libraryContent[state.currentView];
                }

                if (searchTerm) {
                    filteredContent = filteredContent.filter(item => item.title.toLowerCase().includes(searchTerm));
                }

                const activeFiltersForView = state.activeFilters[state.currentView];
                if (activeFiltersForView.length > 0 && activeFiltersForView[0] !== 'All Genres') {
                    filteredContent = filteredContent.filter(item => 
                        activeFiltersForView.every(filter => item.genre.includes(filter))
                    );
                }
                
                renderContent(filteredContent, contentCollection);
            };

            const renderNewArrivals = () => {
                // To keep it simple, new arrivals are hardcoded, but this could be dynamic.
                renderContent(newArrivals, newArrivalsCollection);
            };

            const updateButtonStyles = () => {
                [storiesBtn, poetryBtn, favoritesBtn].forEach(btn => {
                    btn.classList.replace('bg-blue-600', 'bg-gray-200');
                    btn.classList.replace('text-white', 'text-gray-800');
                    btn.classList.remove('shadow-lg', 'shadow-blue-300');
                    btn.classList.add('hover:bg-gray-300');
                });
            
                let activeButton;
                if (state.currentView === 'stories') activeButton = storiesBtn;
                else if (state.currentView === 'poetry') activeButton = poetryBtn;
                else if (state.currentView === 'favorites') activeButton = favoritesBtn;

                if (activeButton) {
                    activeButton.classList.replace('bg-gray-200', 'bg-blue-600');
                    activeButton.classList.replace('text-gray-800', 'text-white');
                    activeButton.classList.add('shadow-lg', 'shadow-blue-300');
                    activeButton.classList.remove('hover:bg-gray-300');
                }
            };
            
            const updateView = (view) => {
                state.currentView = view;
                localStorage.setItem('currentView', view);
                searchInput.value = ''; // Clear search input on view change
                updateButtonStyles();
                renderGenreFilters(); // Re-render genre filters for the new view
                filterAndRender();
            };

            const openModal = (item) => {
                modalTitle.textContent = item.title;
                modalContent.textContent = item.fullText;
                contentModal.classList.remove('hidden');
            };

            const closeModal = () => {
                contentModal.classList.add('hidden');
            };

            // --- Event Handlers ---
            storiesBtn.addEventListener('click', () => updateView('stories'));
            poetryBtn.addEventListener('click', () => updateView('poetry'));
            favoritesBtn.addEventListener('click', () => updateView('favorites'));
            searchInput.addEventListener('input', filterAndRender);
            modalCloseBtn.addEventListener('click', closeModal);

            // Handle suggestions form submission
            suggestionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const title = suggestionTitleInput.value;
                const description = suggestionDescriptionInput.value;
                const type = suggestionTypeSelect.value;
                
                console.log(`New ${type} suggested: "${title}" - "${description}"`);

                suggestionMessage.classList.remove('hidden');
                setTimeout(() => {
                    suggestionMessage.classList.add('hidden');
                    suggestionForm.reset();
                }, 3000);
            });

            // Handle content card interactions (favorites and read)
            document.addEventListener('click', (e) => {
                // Use event delegation for dynamically created elements
                
                // Handle favorite button clicks
                if (e.target.closest('.favorite-btn')) {
                    const button = e.target.closest('.favorite-btn');
                    const id = button.dataset.id;
                    let favorites = getFavorites();
                    const icon = button.querySelector('i');

                    if (favorites.includes(id)) {
                        favorites = favorites.filter(favId => favId !== id);
                        icon.classList.replace('fas', 'far');
                        icon.classList.remove('text-red-500');
                    } else {
                        favorites.push(id);
                        icon.classList.replace('far', 'fas');
                        icon.classList.add('text-red-500');
                    }
                    saveFavorites(favorites);
                    
                    if (state.currentView === 'favorites') {
                        filterAndRender();
                    }
                }

                // Handle 'Read' button clicks
                if (e.target.closest('.read-btn')) {
                    const button = e.target.closest('.read-btn');
                    const id = button.dataset.id;
                    const item = findContentById(id);
                    if (item) {
                        openModal(item);
                    }
                }
            });

            genreFiltersContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('genre-btn')) {
                    const genre = e.target.dataset.genre;
                    const currentActiveFilters = state.activeFilters[state.currentView];

                    if (genre === 'All Genres') {
                        state.activeFilters[state.currentView] = [];
                    } else if (currentActiveFilters.includes(genre)) {
                        state.activeFilters[state.currentView] = currentActiveFilters.filter(f => f !== genre);
                    } else {
                        state.activeFilters[state.currentView] = [genre];
                    }

                    renderGenreFilters();
                    filterAndRender();
                }
            });

            // Set the initial state when the page loads
            updateView(state.currentView);
            renderNewArrivals(); // Render new arrivals on page load
        });
    </script>
</body>
</html>